'use strict';

const {
  DBError,
  UniqueViolationError,
  NotNullViolationError,
  ForeignKeyViolationError,
  ConstraintViolationError,
  CheckViolationError,
  DataError,
} = require('db-errors');
const { Model: NativeModel } = require('objection/lib/model/Model');
const { QueryBuilder: NativeQueryBuilder } = require('objection/lib/queryBuilder/QueryBuilder');
const { QueryBuilderBase } = require('objection/lib/queryBuilder/QueryBuilderBase');
const { QueryBuilderOperation } = require('objection/lib/queryBuilder/operations/QueryBuilderOperation');
const { RelationExpression } = require('objection/lib/queryBuilder/RelationExpression');
const { ValidationError } = require('objection/lib/model/ValidationError');
const { NotFoundError } = require('objection/lib/model/NotFoundError');
const { AjvValidator: NativeAjvValidator } = require('objection/lib/model/AjvValidator');
const { Validator: NativeValidator } = require('objection/lib/model/Validator');
const { Relation } = require('objection/lib/relations/Relation');
const { HasOneRelation } = require('objection/lib/relations/hasOne/HasOneRelation');
const { HasManyRelation } = require('objection/lib/relations/hasMany/HasManyRelation');
const { BelongsToOneRelation } = require('objection/lib/relations/belongsToOne/BelongsToOneRelation');
const { HasOneThroughRelation } = require('objection/lib/relations/hasOneThrough/HasOneThroughRelation');
const { ManyToManyRelation } = require('objection/lib/relations/manyToMany/ManyToManyRelation');
const { transaction } = require('objection/lib/transaction');
const { initialize } = require('objection/lib/initialize');

const {
  snakeCaseMappers,
  knexSnakeCaseMappers,
  knexIdentifierMapping,
} = require('objection/lib/utils/identifierMapping');
const { compose, mixin } = require('objection/lib/utils/mixin');
const { ref } = require('objection/lib/queryBuilder/ReferenceBuilder');
const { val } = require('objection/lib/queryBuilder/ValueBuilder');
const { raw } = require('objection/lib/queryBuilder/RawBuilder');
const { fn } = require('objection/lib/queryBuilder/FunctionBuilder');
const { inherit } = require('objection/lib/utils/classUtils');

// We need to wrap the classes, that people can inherit, with ES5 classes
// so that babel is able to use ES5 inheritance. sigh... Maybe people
// should stop transpiling node apps to ES5 in the year 2019? Node 6
// with full class support was released three years ago.

function Model() {
  // Nothing to do here.
}

function QueryBuilder(...args) {
  NativeQueryBuilder.init(this, ...args);
}

function Validator(...args) {
  NativeValidator.init(this, ...args);
}

function AjvValidator(...args) {
  NativeAjvValidator.init(this, ...args);
}

inherit(Model, NativeModel);
inherit(QueryBuilder, NativeQueryBuilder);
inherit(Validator, NativeValidator);
inherit(AjvValidator, NativeAjvValidator);

Model.QueryBuilder = QueryBuilder;

module.exports = {
  Model,
  QueryBuilder,
  QueryBuilderBase,
  QueryBuilderOperation,
  RelationExpression,
  ValidationError,
  NotFoundError,
  AjvValidator,
  Validator,
  Relation,
  HasOneRelation,
  HasManyRelation,
  BelongsToOneRelation,
  HasOneThroughRelation,
  ManyToManyRelation,

  transaction,
  initialize,
  compose,
  mixin,
  ref,
  val,
  raw,
  fn,
  snakeCaseMappers,
  knexSnakeCaseMappers,
  knexIdentifierMapping,

  DBError,
  UniqueViolationError,
  NotNullViolationError,
  ForeignKeyViolationError,
  ConstraintViolationError,
  CheckViolationError,
  DataError,
};
