const { EventEmitter } = require('events');

const mixin = require('merge-descriptors');

const application = require('node-mocks-http/lib/express/mock-application');
const request = require('node-mocks-http/lib/express/mock-request');
const response = require('node-mocks-http/lib/mockResponse');

const expressResponse = {
    createResponse: response.createResponse
};

function createApplication() {
    const app = function () {};

    mixin(app, EventEmitter.prototype, false);
    mixin(app, application, false);

    app.request = {
        __proto__: request,
        app
    };
    app.response = {
        __proto__: expressResponse.createResponse(),
        app
    };
    app.init();
    return app;
}

module.exports = createApplication;

module.exports.application = application;
module.exports.request = request;
module.exports.response = expressResponse;
