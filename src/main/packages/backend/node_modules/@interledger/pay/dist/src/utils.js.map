{"version":3,"file":"utils.js","sourceRoot":"","sources":["../../src/utils.ts"],"names":[],"mappings":"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","sourcesContent":["import Long from 'long'\nimport { createHash, createHmac } from 'crypto'\n\nconst HASH_ALGORITHM = 'sha256'\nconst ENCRYPTION_KEY_STRING = Buffer.from('ilp_stream_encryption', 'utf8')\nconst FULFILLMENT_GENERATION_STRING = Buffer.from('ilp_stream_fulfillment', 'utf8')\n\nexport const sha256 = (preimage: Buffer): Buffer =>\n  createHash(HASH_ALGORITHM).update(preimage).digest()\n\nexport const hmac = (key: Buffer, message: Buffer): Buffer =>\n  createHmac(HASH_ALGORITHM, key).update(message).digest()\n\nexport const generateEncryptionKey = (sharedSecret: Buffer): Buffer =>\n  hmac(sharedSecret, ENCRYPTION_KEY_STRING)\n\nexport const generateFulfillmentKey = (sharedSecret: Buffer): Buffer =>\n  hmac(sharedSecret, FULFILLMENT_GENERATION_STRING)\n\nconst SHIFT_32 = BigInt(4294967296)\n\n/**\n * Return a rejected Promise if the given Promise does not resolve within the timeout,\n * or return the resolved value of the Promise\n */\nexport const timeout = <T>(duration: number, promise: Promise<T>): Promise<T> => {\n  let timer: NodeJS.Timeout\n  return Promise.race([\n    new Promise<T>((_, reject) => {\n      timer = setTimeout(reject, duration)\n    }),\n    promise.finally(() => clearTimeout(timer)),\n  ])\n}\n\n/** Wait and resolve after the given number of milliseconds */\nexport const sleep = (ms: number): Promise<void> => new Promise((r) => setTimeout(r, ms))\n\n/** Integer greater than or equal to 0 */\nexport class Int {\n  readonly value: bigint\n\n  static ZERO = new Int(BigInt(0))\n  static ONE = new Int(BigInt(1)) as PositiveInt\n  static TWO = new Int(BigInt(2)) as PositiveInt\n  static MAX_U64 = new Int(BigInt('18446744073709551615')) as PositiveInt\n\n  private constructor(n: bigint) {\n    this.value = n\n  }\n\n  static from<T extends Int>(n: T): T\n  static from(n: Long): Int\n  static from(n: NonNegativeInteger): Int\n  static from(n: number): Int | undefined\n  static from(n: bigint): Int | undefined\n  static from(n: string): Int | undefined\n  static from(n: Int | bigint | number | string): Int | undefined // Necessary for amounts passed during setup\n  static from<T extends Long | Int | bigint | number | string>(n: T): Int | undefined {\n    if (n instanceof Int) {\n      return new Int(n.value)\n    } else if (typeof n === 'bigint') {\n      return Int.fromBigint(n)\n    } else if (typeof n === 'string') {\n      return Int.fromString(n)\n    } else if (typeof n === 'number') {\n      return Int.fromNumber(n)\n    } else if (Long.isLong(n)) {\n      return Int.fromLong(n)\n    }\n  }\n\n  private static fromBigint(n: bigint): Int | undefined {\n    if (n >= 0) {\n      return new Int(n)\n    }\n  }\n\n  private static fromString(n: string): Int | undefined {\n    try {\n      return Int.fromBigint(BigInt(n))\n      // eslint-disable-next-line no-empty\n    } catch (_) {}\n  }\n\n  private static fromNumber(n: NonNegativeInteger): Int\n  private static fromNumber(n: number): Int | undefined\n  private static fromNumber<T extends number>(n: T): Int | undefined {\n    if (isNonNegativeInteger(n)) {\n      return new Int(BigInt(n))\n    }\n  }\n\n  private static fromLong(n: Long): Int {\n    const lsb = BigInt(n.getLowBitsUnsigned())\n    const gsb = BigInt(n.getHighBitsUnsigned())\n    return new Int(lsb + SHIFT_32 * gsb)\n  }\n\n  add(n: PositiveInt): PositiveInt\n  add(n: Int): Int\n  add<T extends Int>(n: T): Int {\n    return new Int(this.value + n.value)\n  }\n\n  saturatingSubtract(n: Int): Int {\n    return this.value >= n.value ? new Int(this.value - n.value) : Int.ZERO\n  }\n\n  multiply(n: Int): Int {\n    return new Int(this.value * n.value)\n  }\n\n  multiplyFloor(r: Ratio): Int {\n    return new Int((this.value * r.a.value) / r.b.value)\n  }\n\n  multiplyCeil(r: Ratio): Int {\n    return this.multiply(r.a).divideCeil(r.b)\n  }\n\n  divide(d: PositiveInt): Int {\n    return new Int(this.value / d.value)\n  }\n\n  divideCeil(d: PositiveInt): Int {\n    // Simple algorithm with no modulo/conditional: https://medium.com/@arunistime/how-div-round-up-works-179f1a2113b5\n    return new Int((this.value + d.value - BigInt(1)) / d.value)\n  }\n\n  modulo(n: PositiveInt): Int {\n    return new Int(this.value % n.value)\n  }\n\n  isEqualTo(n: Int): boolean {\n    return this.value === n.value\n  }\n\n  isGreaterThan(n: Int): this is PositiveInt {\n    return this.value > n.value\n  }\n\n  isGreaterThanOrEqualTo(n: PositiveInt): this is PositiveInt\n  isGreaterThanOrEqualTo(n: Int): boolean\n  isGreaterThanOrEqualTo<T extends Int>(n: T): boolean {\n    return this.value >= n.value\n  }\n\n  isLessThan(n: Int): boolean {\n    return this.value < n.value\n  }\n\n  isLessThanOrEqualTo(n: Int): boolean {\n    return this.value <= n.value\n  }\n\n  isPositive(): this is PositiveInt {\n    return this.value > 0\n  }\n\n  orLesser(n?: Int): Int {\n    return !n ? this : this.value <= n.value ? this : n\n  }\n\n  orGreater(n: PositiveInt): PositiveInt\n  orGreater(n?: Int): Int\n  orGreater<T extends Int>(n: T): Int {\n    return !n ? this : this.value >= n.value ? this : n\n  }\n\n  toString(): string {\n    return this.value.toString()\n  }\n\n  toLong(): Long | undefined {\n    if (this.isGreaterThan(Int.MAX_U64)) {\n      return\n    }\n\n    const lsb = BigInt.asUintN(32, this.value)\n    const gsb = (this.value - lsb) / SHIFT_32\n    return new Long(Number(lsb), Number(gsb), true)\n  }\n\n  valueOf(): number {\n    return Number(this.value)\n  }\n\n  toRatio(): Ratio {\n    return Ratio.of(this, Int.ONE)\n  }\n}\n\n/** Integer greater than 0 */\nexport interface PositiveInt extends Int {\n  add(n: Int): PositiveInt\n  multiply(n: PositiveInt): PositiveInt\n  multiply(n: Int): Int\n  multiplyCeil(r: PositiveRatio): PositiveInt\n  multiplyCeil(r: Ratio): Int\n  divideCeil(n: PositiveInt): PositiveInt\n  isEqualTo(n: Int): n is PositiveInt\n  isLessThan(n: Int): n is PositiveInt\n  isLessThanOrEqualTo(n: Int): n is PositiveInt\n  isPositive(): true\n  orLesser(n?: PositiveInt): PositiveInt\n  orLesser(n: Int): Int\n  orGreater(n?: Int): PositiveInt\n  toRatio(): PositiveRatio\n}\n\ndeclare class Tag<N extends string> {\n  protected __nominal: N\n}\n\nexport type Brand<T, N extends string> = T & Tag<N>\n\n/** Finite number greater than or equal to 0 */\nexport type NonNegativeRational = Brand<number, 'NonNegativeRational'>\n\n/** Is the given number greater than or equal to 0, not `NaN`, and not `Infinity`? */\nexport const isNonNegativeRational = (o: unknown): o is NonNegativeRational =>\n  typeof o === 'number' && Number.isFinite(o) && o >= 0\n\n/** Integer greater than or equal to 0 */\nexport type NonNegativeInteger = Brand<number, 'NonNegativeInteger'>\n\n/** Is the given number an integer (not `NaN` nor `Infinity`) and greater than or equal to 0? */\nexport const isNonNegativeInteger = (o: number): o is NonNegativeInteger =>\n  Number.isInteger(o) && o >= 0\n\n/**\n * Ratio of two integers: a numerator greater than or equal to 0,\n * and a denominator greater than 0\n */\nexport class Ratio {\n  /** Numerator */\n  readonly a: Int\n  /** Denominator */\n  readonly b: PositiveInt\n\n  private constructor(a: Int, b: PositiveInt) {\n    this.a = a\n    this.b = b\n  }\n\n  static of(a: PositiveInt, b: PositiveInt): PositiveRatio\n  static of(a: Int, b: PositiveInt): Ratio\n  static of<T extends Int>(a: T, b: PositiveInt): Ratio {\n    return new Ratio(a, b)\n  }\n\n  /**\n   * Convert a number (not `NaN`, `Infinity` or negative) into a Ratio.\n   * Zero becomes 0/1.\n   */\n  static from(n: NonNegativeRational): Ratio\n  static from(n: number): Ratio | undefined\n  static from<T extends number>(n: T): Ratio | undefined {\n    if (!isNonNegativeRational(n)) {\n      return\n    }\n\n    let e = 1\n    while (!Number.isInteger(n * e)) {\n      e *= 10\n    }\n\n    const a = Int.from(n * e) as Int\n    const b = Int.from(e) as PositiveInt\n    return new Ratio(a, b)\n  }\n\n  reciprocal(): PositiveRatio | undefined {\n    if (this.a.isPositive()) {\n      return Ratio.of(this.b, this.a)\n    }\n  }\n\n  floor(): bigint {\n    return this.a.divide(this.b).value\n  }\n\n  ceil(): bigint {\n    return this.a.divideCeil(this.b).value\n  }\n\n  isEqualTo(r: Ratio): boolean {\n    return this.a.value * r.b.value === this.b.value * r.a.value\n  }\n\n  isGreaterThan(r: Ratio): this is PositiveRatio {\n    return this.a.value * r.b.value > this.b.value * r.a.value\n  }\n\n  isGreaterThanOrEqualTo(r: PositiveRatio): this is PositiveRatio\n  isGreaterThanOrEqualTo(r: Ratio): boolean\n  isGreaterThanOrEqualTo<T extends Ratio>(r: T): boolean {\n    return this.a.value * r.b.value >= this.b.value * r.a.value\n  }\n\n  isLessThan(r: Ratio): boolean {\n    return this.a.value * r.b.value < this.b.value * r.a.value\n  }\n\n  isLessThanOrEqualTo(r: Ratio): boolean {\n    return this.a.value * r.b.value <= this.b.value * r.a.value\n  }\n\n  isPositive(): this is PositiveRatio {\n    return this.a.isPositive()\n  }\n\n  valueOf(): number {\n    return +this.a / +this.b\n  }\n\n  toString(): string {\n    return this.valueOf().toString()\n  }\n\n  toJSON(): [string, string] {\n    return [this.a.toString(), this.b.toString()]\n  }\n}\n\n/** Ratio of two integers greater than 0 */\nexport interface PositiveRatio extends Ratio {\n  readonly a: PositiveInt\n  readonly b: PositiveInt\n\n  reciprocal(): PositiveRatio\n  isEqualTo(r: Ratio): r is PositiveRatio\n  isLessThan(r: Ratio): r is PositiveRatio\n  isLessThanOrEqualTo(r: Ratio): r is PositiveRatio\n  isPositive(): true\n}\n"]}