{"version":3,"file":"payment-pointer.js","sourceRoot":"","sources":["../../src/payment-pointer.ts"],"names":[],"mappings":";;;AAAO,MAAM,aAAa,GAAG,CAAC,MAAc,EAAE,IAAa,EAAmB,EAAE;IAC9E,IAAI;QACF,MAAM,GAAG,GAAG,IAAI,GAAG,CAAC,MAAM,EAAE,IAAI,CAAC,CAAA;QACjC,IAAI,GAAG,CAAC,QAAQ,KAAK,QAAQ,IAAI,GAAG,CAAC,QAAQ,KAAK,OAAO,EAAE;YACzD,OAAO,GAAG,CAAA;SACX;KACF;IAAC,OAAO,CAAC,EAAE;QACV,OAAM;KACP;AACH,CAAC,CAAA;AATY,QAAA,aAAa,iBASzB;AAGD,MAAa,UAAU;IAwDrB,YAAoB,GAAQ;QAC1B,IAAI,CAAC,QAAQ,GAAG,GAAG,CAAC,QAAQ,CAAA;QAC5B,IAAI,CAAC,QAAQ,GAAG,GAAG,CAAC,QAAQ,CAAA;QAG5B,MAAM,QAAQ,GAAG,GAAG,CAAC,QAAQ,CAAC,OAAO,CAAC,KAAK,EAAE,EAAE,CAAC,CAAA;QAGhD,IAAI,CAAC,CAAC,QAAQ,KAAK,EAAE,IAAI,QAAQ,KAAK,UAAU,CAAC,YAAY,CAAC,EAAE;YAC9D,IAAI,CAAC,IAAI,GAAG,QAAQ,CAAA;SACrB;QAGD,IAAI,CAAC,MAAM,GAAG,GAAG,CAAC,MAAM,GAAG,GAAG,CAAC,IAAI,CAAA;IACrC,CAAC;IAtDD,MAAM,CAAC,kBAAkB,CAAC,cAAsB;QAC9C,IAAI,CAAC,cAAc,CAAC,UAAU,CAAC,GAAG,CAAC,EAAE;YACnC,OAAM;SACP;QAWD,MAAM,GAAG,GAAG,IAAA,qBAAa,EAAC,UAAU,GAAG,cAAc,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAA;QACnE,IACE,CAAC,GAAG;YACJ,GAAG,CAAC,QAAQ,KAAK,EAAE;YACnB,GAAG,CAAC,QAAQ,KAAK,EAAE;YACnB,GAAG,CAAC,IAAI,KAAK,EAAE;YACf,GAAG,CAAC,MAAM,KAAK,EAAE;YACjB,GAAG,CAAC,IAAI,KAAK,EAAE,EACf;YACA,OAAM;SACP;QAED,OAAO,IAAI,UAAU,CAAC,GAAG,CAAC,CAAA;IAC5B,CAAC;IAGD,MAAM,CAAC,OAAO,CAAC,MAAc;QAC3B,MAAM,GAAG,GAAG,IAAA,qBAAa,EAAC,MAAM,CAAC,CAAA;QACjC,IAAI,CAAC,GAAG,IAAI,GAAG,CAAC,QAAQ,KAAK,EAAE,IAAI,GAAG,CAAC,QAAQ,KAAK,EAAE,IAAI,GAAG,CAAC,IAAI,KAAK,EAAE,EAAE;YACzE,OAAM;SACP;QAGD,OAAO,IAAI,UAAU,CAAC,GAAG,CAAC,CAAA;IAC5B,CAAC;IAmBD,aAAa;;QACX,OAAO,CACL,IAAI,CAAC,QAAQ,GAAG,IAAI,GAAG,IAAI,CAAC,QAAQ,GAAG,CAAC,MAAA,IAAI,CAAC,IAAI,mCAAI,UAAU,CAAC,YAAY,CAAC,GAAG,IAAI,CAAC,MAAM,CAC5F,CAAA;IACH,CAAC;IAGD,SAAS;;QACP,OAAO,IAAI,CAAC,QAAQ,GAAG,IAAI,GAAG,IAAI,CAAC,QAAQ,GAAG,CAAC,MAAA,IAAI,CAAC,IAAI,mCAAI,UAAU,CAAC,YAAY,CAAC,CAAA;IACtF,CAAC;IAMD,QAAQ;QACN,OAAO,IAAI,CAAC,aAAa,EAAE,CAAA;IAC7B,CAAC;IAOD,gBAAgB;;QACd,IAAI,IAAI,CAAC,QAAQ,KAAK,QAAQ,IAAI,IAAI,CAAC,MAAM,KAAK,EAAE;YAAE,OAAM;QAC5D,OAAO,GAAG,GAAG,IAAI,CAAC,QAAQ,GAAG,CAAC,MAAA,IAAI,CAAC,IAAI,mCAAI,EAAE,CAAC,CAAA;IAChD,CAAC;;AApGH,gCAqGC;AApGgB,uBAAY,GAAG,kBAAkB,CAAA","sourcesContent":["export const createHttpUrl = (rawUrl: string, base?: string): URL | undefined => {\n  try {\n    const url = new URL(rawUrl, base)\n    if (url.protocol === 'https:' || url.protocol === 'http:') {\n      return url\n    }\n  } catch (_) {\n    return\n  }\n}\n\n/** URL of a unique account payable over Interledger, queryable via SPSP or Open Payments */\nexport class AccountUrl {\n  private static DEFAULT_PATH = '/.well-known/pay'\n\n  /** Protocol of the URL */\n  private protocol: string\n\n  /** Domain name of the URL */\n  private hostname: string\n\n  /** Path with stripped trailing slash, or `undefined` for default, well-known account path */\n  private path?: string\n\n  /** Query string and/or fragment. Empty string for PP, optional for the full URL format */\n  private suffix: string\n\n  /** Parse a [payment pointer](https://paymentpoiners.org) prefixed with \"$\" */\n  static fromPaymentPointer(paymentPointer: string): AccountUrl | undefined {\n    if (!paymentPointer.startsWith('$')) {\n      return\n    }\n\n    /**\n     * From paymentpointers.org/syntax-resolution/:\n     *\n     * \"...the Payment Pointer syntax only supports a host which excludes the userinfo and port.\n     * The Payment Pointer syntax also excludes the query and fragment parts that are allowed in the URL syntax.\n     *\n     * Payment Pointers that do not meet the limited syntax of this profile MUST be\n     * considered invalid and should not be used to resolve a URL.\"\n     */\n    const url = createHttpUrl('https://' + paymentPointer.substring(1))\n    if (\n      !url || // URL was invalid\n      url.username !== '' ||\n      url.password !== '' ||\n      url.port !== '' ||\n      url.search !== '' || // No query params\n      url.hash !== '' // No fragment\n    ) {\n      return\n    }\n\n    return new AccountUrl(url)\n  }\n\n  /** Parse SPSP/Open Payments account URL. Must be HTTPS/HTTP, contain no credentials, and no port. */\n  static fromUrl(rawUrl: string): AccountUrl | undefined {\n    const url = createHttpUrl(rawUrl)\n    if (!url || url.username !== '' || url.password !== '' || url.port !== '') {\n      return\n    }\n\n    // Don't error if query string or fragment is included -- allowed from URL format\n    return new AccountUrl(url)\n  }\n\n  private constructor(url: URL) {\n    this.protocol = url.protocol\n    this.hostname = url.hostname\n\n    // Strip trailing slash. If empty, `URL` still adds back the initial slash\n    const pathname = url.pathname.replace(/\\/$/, '')\n\n    // Don't set the path if it corresponds to the default\n    if (!(pathname === '' || pathname === AccountUrl.DEFAULT_PATH)) {\n      this.path = pathname\n    }\n\n    // Empty for payment pointers (fails), optional for full URL variant\n    this.suffix = url.search + url.hash\n  }\n\n  /** Endpoint URL for SPSP queries to the account. Includes query string and/or fragment */\n  toEndpointUrl(): string {\n    return (\n      this.protocol + '//' + this.hostname + (this.path ?? AccountUrl.DEFAULT_PATH) + this.suffix\n    )\n  }\n\n  /** Endpoint URL for SPSP queries to the account. Excludes query string and/or fragment */\n  toBaseUrl(): string {\n    return this.protocol + '//' + this.hostname + (this.path ?? AccountUrl.DEFAULT_PATH)\n  }\n\n  /**\n   * SPSP/Open Payments account URL, identifying a unique account. Use this for comparing sameness between\n   * accounts.\n   */\n  toString(): string {\n    return this.toEndpointUrl()\n  }\n\n  /**\n   * Unique payment pointer for this SPSP or Open Payments account. Stripped trailing slash.\n   * Returns undefined when the protocol is not \"https\".\n   * Returns undefined when there is a query string or fragment.\n   */\n  toPaymentPointer(): string | undefined {\n    if (this.protocol !== 'https:' || this.suffix !== '') return\n    return '$' + this.hostname + (this.path ?? '')\n  }\n}\n"]}